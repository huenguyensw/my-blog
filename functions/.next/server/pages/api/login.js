"use strict";(()=>{var e={};e.id=662,e.ids=[662],e.modules={37:e=>{e.exports=import("uuid")},829:e=>{e.exports=require("jsonwebtoken")},2662:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>u,routeModule:()=>l});var s=t(3480),o=t(8667),i=t(6435),a=t(6591),d=e([a]);a=(d.then?(await d)():d)[0];let u=(0,i.M)(a,"default"),c=(0,i.M)(a,"config"),l=new s.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/login",pathname:"/api/login",bundlePath:"",filename:""},userland:a});n()}catch(e){n(e)}})},3056:(e,r,t)=>{t.d(r,{A:()=>o});var n=t(6037);let s=new(t.n(n)()).Schema({firstName:{type:String,required:!0},lastName:{type:String,required:!0},email:{type:String,required:!0},userName:{type:String,required:!0},password:{type:String,required:!0},imageUrl:{type:String,required:!0},favorites:{type:[String],default:[]}}),o=n.models.User||(0,n.model)("User",s)},3480:(e,r,t)=>{e.exports=t(5600)},5486:e=>{e.exports=require("bcrypt")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6037:e=>{e.exports=require("mongoose")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},6591:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{default:()=>p});var s=t(6810),o=t(3056),i=t(8546),a=t(829),d=t.n(a),u=t(5486),c=t.n(u),l=t(37),g=e([l]);async function p(e,r){if("POST"===e.method)try{let{email:t,password:n}=e.body;if(!t||!n)return r.status(400).json({message:"Obligatoriska f\xe4lt saknas"});await (0,s.X)();let a=await o.A.findOne({email:t});if(!a)return r.status(409).json({message:"Ogiltiga inloggningsuppgifter"});let u=await c().compare(n,a.password);if(console.log("isPasswordValid",u,n,a.password),!u)return r.status(401).json({message:"Ogiltigt l\xf6senord"});if(!i.A.secretKey)throw Error("JWT secret key is not defined.");let g=d().sign({id:a._id},i.A.secretKey,{expiresIn:"1h"}),p=(0,l.v4)();r.status(200).json({message:"Inloggningen lyckades!",sessionId:p,accessToken:g,user:a})}catch(e){console.error("API Error:",e),r.status(500).json({message:"Internt serverfel",error:e})}else r.status(405).json({message:"Metod ej till\xe5ten"})}l=(g.then?(await g)():g)[0],n()}catch(e){n(e)}})},6810:(e,r,t)=>{t.d(r,{X:()=>o});var n=t(6037),s=t.n(n);if(!process.env.DB_URL)throw Error("⚠️ MongoDB URI is not defined in environment variables.");async function o(){if(!(s().connection.readyState>=1))try{await s().connect(process.env.DB_URL,{dbName:"mushroomdb"}),console.log("✅ Connected to MongoDB")}catch(e){console.error("❌ MongoDB Connection Error:",e),process.exit(1)}}},8546:(e,r,t)=>{t.d(r,{A:()=>s});let n=require("dotenv");t.n(n)().config();let s={secretKey:process.env.JWT_SECRET_KEY}},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=2662);module.exports=t})();