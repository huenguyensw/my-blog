"use strict";(()=>{var e={};e.id=836,e.ids=[836],e.modules={1174:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>u,routeModule:()=>m});var i=t(3480),n=t(8667),s=t(6435),o=t(3293),d=e([o]);o=(d.then?(await d)():d)[0];let u=(0,s.M)(o,"default"),l=(0,s.M)(o,"config"),m=new i.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/user/[id]",pathname:"/api/user/[id]",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},3056:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(6037);let i=new(t.n(a)()).Schema({firstName:{type:String,required:!0},lastName:{type:String,required:!0},email:{type:String,required:!0},userName:{type:String,required:!0},password:{type:String,required:!0},imageUrl:{type:String,required:!0},favorites:{type:[String],default:[]}}),n=a.models.User||(0,a.model)("User",i)},3293:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>p,default:()=>c});var i=t(6810),n=t(3056),s=t(5486),o=t.n(s),d=t(7313),u=t(9021),l=t.n(u),m=e([d]);d=(m.then?(await m)():m)[0];let p={api:{bodyParser:!1}};async function c(e,r){if("PUT"!==e.method)return r.status(405).json({message:"Metod ej till\xe5ten"});new d.IncomingForm().parse(e,async(t,a,s)=>{if(t)return console.error("Form parsing error:",t),r.status(500).json({message:"Formul\xe4rfel",error:t});try{await (0,i.X)();let t=Array.isArray(a.firstName)?a.firstName[0]:a.firstName,d=Array.isArray(a.lastName)?a.lastName[0]:a.lastName,u=Array.isArray(a.email)?a.email[0]:a.email,m=Array.isArray(a.userName)?a.userName[0]:a.userName,c=Array.isArray(a.password)?a.password[0]:a.password;if(!t||!d||!u||!m||!c)return r.status(400).json({message:"Missing required fields"});let p=await n.A.findById(e.query.id);if(!p)return r.status(404).json({message:"Anv\xe4ndare hittades inte"});if(!c)return r.status(400).json({message:"Password is required"});let f=await o().genSalt(10),g=await o().hash(c,f),y=p.imageUrl;if(s.imageUrl&&s.imageUrl[0]){let e=s.imageUrl[0],r=l().readFileSync(e.filepath),t=`uploads/${Date.now()}-${e.originalFilename}`;l().writeFileSync(`./public/${t}`,r),y="/"+t}console.log("Uploaded image URL:",s.imageUrl);let A=await n.A.findByIdAndUpdate(e.query.id,{firstName:t,lastName:d,email:u,userName:m,password:g,imageUrl:y},{new:!0});r.status(200).json(A)}catch(e){console.error("Update error:",e),r.status(500).json({message:"Internt serverfel",error:e})}})}a()}catch(e){a(e)}})},3480:(e,r,t)=>{e.exports=t(5600)},5486:e=>{e.exports=require("bcrypt")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6037:e=>{e.exports=require("mongoose")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},6810:(e,r,t)=>{t.d(r,{X:()=>n});var a=t(6037),i=t.n(a);if(!process.env.DB_URL)throw Error("⚠️ MongoDB URI is not defined in environment variables.");async function n(){if(!(i().connection.readyState>=1))try{await i().connect(process.env.DB_URL,{dbName:"mushroomdb"}),console.log("✅ Connected to MongoDB")}catch(e){console.error("❌ MongoDB Connection Error:",e),process.exit(1)}}},7313:e=>{e.exports=import("formidable")},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9021:e=>{e.exports=require("fs")}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1174);module.exports=t})();